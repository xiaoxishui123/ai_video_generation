# ğŸ¯ ç«å±±å¼•æ“å‚æ•°å®Œæ•´ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2026-01-03  
**ç‰ˆæœ¬**: v0.0.45 â†’ v0.0.47 (å»ºè®®)  
**ä¸¥é‡æ€§**: ğŸ”´ é«˜ - å¤šä¸ªå‚æ•°å®Œå…¨ä¸ç”Ÿæ•ˆ

---

## ğŸ“Š ä¿®å¤æ€»ç»“

### ä¿®å¤å‰ âŒ

```
æäº¤çš„ prompt: è®©å›¾ç‰‡åŠ¨èµ·æ¥ --duration 5
```

ç”¨æˆ·é…ç½®ï¼š
- åˆ†è¾¨ç‡: 1080p âŒ ä¸ç”Ÿæ•ˆ
- éŸ³é¢‘: å¯ç”¨ âŒ ä¸ç”Ÿæ•ˆ
- æ—ç™½: "å®é™çš„æ—©æ™¨" âŒ ä¸ç”Ÿæ•ˆ

### ä¿®å¤å âœ…

```
æäº¤çš„ prompt: è®©å›¾ç‰‡åŠ¨èµ·æ¥ --duration 5 --resolution 1080p --audio enable
```

ç”¨æˆ·é…ç½®ï¼š
- åˆ†è¾¨ç‡: 1080p âœ… ç”Ÿæ•ˆ
- éŸ³é¢‘: å¯ç”¨ âœ… ç”Ÿæ•ˆ  
- æ—ç™½: æ”¯æŒ âœ… åˆå¹¶åˆ°prompt

---

## âœ… å·²ä¿®å¤çš„å‚æ•°

| å‚æ•° | ä¿®å¤å‰ | ä¿®å¤å | ä»£ç ä½ç½® |
|------|--------|--------|---------|
| **enable_audio** | âŒ æœªä¼ é€’ | âœ… `--audio enable/disable` | è¡Œ 638-641 |
| **audio_url** | âŒ æœªä¼ é€’ | âœ… `--audio-url {url}` | è¡Œ 644-645 |
| **narration** | âŒ æœªä¼ é€’ | âœ… åˆå¹¶åˆ° prompt | è¡Œ 648-655 |
| **resolution** | âŒ æœªä¼ é€’ | âœ… `--resolution {res}` | è¡Œ 634-635 |

---

## âš ï¸ å¾…éªŒè¯çš„å‚æ•°

| å‚æ•° | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **aspect_ratio** | ğŸŸ¡ æœªæ·»åŠ  | I2Vå¯èƒ½ç”±è¾“å…¥å›¾ç‰‡å†³å®šï¼Œä¸éœ€è¦ `--ratio` |
| **camera_control** | ğŸŸ¡ æœªå®šä¹‰ | YAMLä¸­æœªå®šä¹‰ï¼Œå¯èƒ½éœ€è¦æ·»åŠ  |

---

## ğŸ”§ è¯¦ç»†ä¿®æ”¹å†…å®¹

### 1. æ·»åŠ  Resolution å‚æ•°

**ä½ç½®**: `tools/image_to_video.py` è¡Œ 611-616

```python
# ğŸ†• å¤„ç† resolution å‚æ•°ï¼ˆç«å±±å¼•æ“æ”¯æŒï¼‰
resolution_raw = params.get("resolution", "1080p")
if not resolution_raw or (isinstance(resolution_raw, str) and not resolution_raw.strip()):
    resolution = "1080p"
else:
    resolution = str(resolution_raw).strip()
```

**ä½ç½®**: è¡Œ 633-635

```python
# ğŸ†• æ·»åŠ åˆ†è¾¨ç‡å‚æ•°ï¼ˆå‚è€ƒ text_to_video.py è¡Œ544ï¼‰
if resolution and "--resolution" not in full_prompt:
    full_prompt = f"{full_prompt} --resolution {resolution}"
```

---

### 2. æ·»åŠ  Audio å‚æ•°

**ä½ç½®**: `tools/image_to_video.py` è¡Œ 618-621

```python
# ğŸ†• è¯»å–éŸ³é¢‘å‚æ•°
enable_audio = params.get("enable_audio", True)
audio_url_raw = params.get("audio_url", "")
narration = params.get("narration", "")
```

**ä½ç½®**: è¡Œ 637-641

```python
# æ·»åŠ éŸ³é¢‘å‚æ•°
if enable_audio and "--audio" not in full_prompt:
    full_prompt = f"{full_prompt} --audio enable"
elif not enable_audio and "--audio" not in full_prompt:
    full_prompt = f"{full_prompt} --audio disable"
```

---

### 3. æ·»åŠ ç”¨æˆ·æç¤ºä¿¡æ¯

**ä½ç½®**: è¡Œ 674-683

```python
# ğŸ†• æ„å»ºéŸ³é¢‘é…ç½®ä¿¡æ¯
audio_info = ""
if audio_url:
    audio_info = f"ğŸµ éŸ³é¢‘: ä½¿ç”¨è‡ªå®šä¹‰éŸ³é¢‘\n"
elif enable_audio:
    audio_info = f"ğŸ¤ é…éŸ³: è‡ªåŠ¨ç”Ÿæˆ\n"
else:
    audio_info = f"ğŸ”‡ éŸ³é¢‘: æ— å£°è§†é¢‘\n"
if narration and enable_audio and not audio_url:
    audio_info += f"ğŸ“œ æ—ç™½: {narration[:30]}...\n"
```

**ä½ç½®**: è¡Œ 685-694

```python
yield self.create_text_message(
    f"ğŸš€ **æäº¤å›¾ç”Ÿè§†é¢‘ä»»åŠ¡**\n\n"
    f"ğŸ¢ å¹³å°: ç«å±±æ–¹èˆŸ\n"
    f"ğŸ“ æ¨¡å‹: {model_name}\n"
    f"ğŸ–¼ï¸ å›¾ç‰‡: {'Base64' if used_base64 else image_url[:60]}\n"
    f"ğŸ“º åˆ†è¾¨ç‡: {resolution}\n"    # ğŸ†• æ–°å¢
    f"â±ï¸ æ—¶é•¿: {duration}ç§’\n"
    f"{audio_info}"                  # ğŸ†• æ–°å¢
    f"ğŸ’¬ æè¿°: {prompt[:50]}..."
)
```

---

## ğŸ“‹ å‚æ•°å®Œæ•´å¯¹æ¯”

### ç«å±±å¼•æ“ I2V ç°åœ¨æ”¯æŒçš„å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | æ ¼å¼ | ç¤ºä¾‹ |
|------|--------|------|------|
| duration | 5 | `--duration {ç§’}` | `--duration 5` |
| resolution | 1080p | `--resolution {åˆ†è¾¨ç‡}` | `--resolution 1080p` |
| enable_audio | true | `--audio enable/disable` | `--audio enable` |
| audio_url | - | `--audio-url {url}` | `--audio-url https://...` |
| narration | - | åˆå¹¶åˆ° prompt | `{prompt}ã€‚æ—ç™½ï¼š{å†…å®¹}` |

### å¯¹æ¯”æ–‡ç”Ÿè§†é¢‘ (T2V)

| å‚æ•° | I2V | T2V | è¯´æ˜ |
|------|-----|-----|------|
| duration | âœ… | âœ… | æ—¶é•¿ |
| resolution | âœ… | âœ… | åˆ†è¾¨ç‡ |
| aspect_ratio | âŒ | âœ… | I2Vç”±å›¾ç‰‡å†³å®š |
| camera_control | âŒ | âœ… | I2Vå¯èƒ½ä¸éœ€è¦ |
| enable_audio | âœ… | âŒ | I2Væ–°å¢ |

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯•1: é«˜åˆ†è¾¨ç‡ + éŸ³é¢‘

```yaml
provider: volcengine
model: doubao-seedance-1-5-pro-251215
image_url: "https://example.com/test.jpg"
prompt: "è®©å›¾ç‰‡åŠ¨èµ·æ¥"
resolution: "1080p"
enable_audio: true
duration: "5"
```

**é¢„æœŸè¾“å‡º**:
```
ğŸš€ **æäº¤å›¾ç”Ÿè§†é¢‘ä»»åŠ¡**

ğŸ¢ å¹³å°: ç«å±±æ–¹èˆŸ
ğŸ“ æ¨¡å‹: Seedance 1.5 Pro I2V (æ¨è)
ğŸ–¼ï¸ å›¾ç‰‡: https://example.com/test.jpg
ğŸ“º åˆ†è¾¨ç‡: 1080p
â±ï¸ æ—¶é•¿: 5ç§’
ğŸ¤ é…éŸ³: è‡ªåŠ¨ç”Ÿæˆ
ğŸ’¬ æè¿°: è®©å›¾ç‰‡åŠ¨èµ·æ¥
```

**æäº¤çš„ prompt**:
```
è®©å›¾ç‰‡åŠ¨èµ·æ¥ --duration 5 --resolution 1080p --audio enable
```

---

### æµ‹è¯•2: ä½åˆ†è¾¨ç‡ + æ— éŸ³é¢‘

```yaml
resolution: "480p"
enable_audio: false
```

**é¢„æœŸè¾“å‡º**:
```
ğŸ“º åˆ†è¾¨ç‡: 480p
â±ï¸ æ—¶é•¿: 5ç§’
ğŸ”‡ éŸ³é¢‘: æ— å£°è§†é¢‘
```

**æäº¤çš„ prompt**:
```
è®©å›¾ç‰‡åŠ¨èµ·æ¥ --duration 5 --resolution 480p --audio disable
```

---

### æµ‹è¯•3: å¸¦æ—ç™½

```yaml
prompt: "ç¾ä¸½çš„é£æ™¯"
narration: "è¿™æ˜¯ä¸€ä¸ªå®é™çš„æ—©æ™¨ï¼Œé˜³å…‰æ´’åœ¨å¤§åœ°ä¸Š"
enable_audio: true
```

**é¢„æœŸè¾“å‡º**:
```
ğŸ¤ é…éŸ³: è‡ªåŠ¨ç”Ÿæˆ
ğŸ“œ æ—ç™½: è¿™æ˜¯ä¸€ä¸ªå®é™çš„æ—©æ™¨ï¼Œé˜³å…‰æ´’åœ¨å¤§åœ°ä¸Š
```

**æäº¤çš„ prompt**:
```
ç¾ä¸½çš„é£æ™¯ã€‚æ—ç™½å†…å®¹ï¼šè¿™æ˜¯ä¸€ä¸ªå®é™çš„æ—©æ™¨ï¼Œé˜³å…‰æ´’åœ¨å¤§åœ°ä¸Š --duration 5 --resolution 1080p --audio enable
```

---

## ğŸ“‚ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

1. **tools/image_to_video.py**
   - +12 è¡Œ: resolutionå‚æ•°è¯»å–å’Œå¤„ç†
   - +4 è¡Œ: resolutionå‚æ•°æ·»åŠ åˆ°prompt
   - +10 è¡Œ: audioå‚æ•°è¯»å–å’Œå¤„ç†
   - +15 è¡Œ: audioå‚æ•°æ·»åŠ åˆ°prompt
   - +10 è¡Œ: audioçŠ¶æ€æ˜¾ç¤º
   - **æ€»è®¡**: +51 è¡Œä»£ç 

2. **tools/image_to_video.yaml**
   - 3å¤„æ ‡æ³¨æ›´æ–°ï¼ˆéŸ³é¢‘å‚æ•°æ”¯æŒè¯´æ˜ï¼‰

---

## âœ… ä¿®å¤éªŒè¯æ¸…å•

- [ ] è¯­æ³•æ£€æŸ¥é€šè¿‡ âœ…
- [ ] é‡æ–°æ‰“åŒ…æ’ä»¶
- [ ] åœ¨ Dify ä¸­é‡æ–°å®‰è£…
- [ ] æµ‹è¯• 1080p åˆ†è¾¨ç‡ç”Ÿæ•ˆ
- [ ] æµ‹è¯• 480p åˆ†è¾¨ç‡ç”Ÿæ•ˆ
- [ ] æµ‹è¯•éŸ³é¢‘å¯ç”¨ç”Ÿæ•ˆ
- [ ] æµ‹è¯•éŸ³é¢‘ç¦ç”¨ç”Ÿæ•ˆ
- [ ] æµ‹è¯•æ—ç™½æ–‡æœ¬ç”Ÿæ•ˆ
- [ ] å¯¹æ¯”ç”Ÿæˆçš„è§†é¢‘è´¨é‡

---

## ğŸ¯ å½±å“è¯„ä¼°

### ä¿®å¤å‰çš„é—®é¢˜

1. **ç”¨æˆ·è®¾ç½®åˆ†è¾¨ç‡æ— æ•ˆ** âŒ
   - é€‰æ‹© 1080p â†’ å®é™…å¯èƒ½æ˜¯ 720p
   - é€‰æ‹© 480p â†’ å®é™…å¯èƒ½æ˜¯ 720p

2. **éŸ³é¢‘é…ç½®æ— æ•ˆ** âŒ
   - å¯ç”¨éŸ³é¢‘ â†’ è§†é¢‘æ— å£°
   - ç¦ç”¨éŸ³é¢‘ â†’ å¯èƒ½ä»æœ‰å£°éŸ³ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰

### ä¿®å¤åçš„æ”¹è¿›

1. **åˆ†è¾¨ç‡å®Œå…¨å¯æ§** âœ…
   - é€‰æ‹© 1080p â†’ ç”Ÿæˆ 1080p è§†é¢‘
   - é€‰æ‹© 480p â†’ ç”Ÿæˆ 480p è§†é¢‘

2. **éŸ³é¢‘å®Œå…¨å¯æ§** âœ…
   - å¯ç”¨éŸ³é¢‘ â†’ è§†é¢‘æœ‰å£°
   - ç¦ç”¨éŸ³é¢‘ â†’ è§†é¢‘æ— å£°
   - è‡ªå®šä¹‰æ—ç™½ â†’ é…éŸ³ç¬¦åˆé¢„æœŸ

---

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

1. **ç«‹å³æµ‹è¯•** ğŸ”´
   - é‡æ–°æ‰“åŒ…æ’ä»¶
   - æµ‹è¯•æ‰€æœ‰å‚æ•°æ˜¯å¦ç”Ÿæ•ˆ
   - å¯¹æ¯”è§†é¢‘è´¨é‡å’ŒéŸ³é¢‘æ•ˆæœ

2. **å¯é€‰ä¼˜åŒ–** ğŸŸ¡
   - è€ƒè™‘æ˜¯å¦éœ€è¦æ·»åŠ  `camera_control` å‚æ•°
   - éªŒè¯ `aspect_ratio` æ˜¯å¦éœ€è¦ï¼ˆI2Vå¯èƒ½ç”±å›¾ç‰‡å†³å®šï¼‰

3. **æ–‡æ¡£æ›´æ–°** ğŸŸ¢
   - æ›´æ–° README.md è¯´æ˜æ‰€æœ‰æ”¯æŒçš„å‚æ•°
   - æ·»åŠ å‚æ•°ä½¿ç”¨ç¤ºä¾‹

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- å‚æ•°ç¼ºå¤±åˆ†æ: `/tmp/volcengine_params_missing_report.md`
- éŸ³é¢‘ä¿®å¤æŠ¥å‘Š: `/home/dify/ai_video_generation/AUDIO_FIX_CHANGELOG.md`
- æµ‹è¯•æŒ‡å—: `/home/dify/ai_video_generation/TEST_AUDIO_FIX.md`

